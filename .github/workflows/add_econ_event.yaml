name: Add Econ Event
true:
  push:
    branches:
    - main
  workflow_dispatch:
    inputs:
      date:
        description: YYYY-MM-DD
        required: true
      region:
        description: Country/region code (US, CA, MX, BR, etc.)
        required: true
      event:
        description: Event title (e.g., CPI, FOMC, NFP)
        required: true
      importance:
        description: low | medium | high
        required: true
        type: choice
        options:
        - low
        - medium
        - high
permissions:
  contents: write
jobs:
  precheck:
    runs-on: ubuntu-latest
    outputs:
      ok: ${{ steps.p.outputs.ok }}
    steps:
    - uses: actions/checkout@v4
    - id: p
      uses: ./.github/actions/precheck
  add:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Append to config/econ_calendar.yaml
      run: "mkdir -p config\ntouch config/econ_calendar.yaml\ncat >> config/econ_calendar.yaml\
        \ <<EOF\n\n- date: \"${{ github.event.inputs.date }}\"\n  region: ${{ github.event.inputs.region\
        \ }}\n  event: ${{ github.event.inputs.event }}\n  importance: ${{ github.event.inputs.importance\
        \ }}\nEOF\n"
    - name: Commit & push
      run: 'git config user.name "github-actions"

        git config user.email "actions@users.noreply.github.com"

        git add config/econ_calendar.yaml

        git commit -m "chore(econ): add ${{ github.event.inputs.region }} ${{ github.event.inputs.event
        }} on ${{ github.event.inputs.date }}" || echo "No changes"

        git push

        '
    needs: precheck
    if: ${{ needs.precheck.outputs.ok == 'true' && github.ref == 'refs/heads/main'
      }}
