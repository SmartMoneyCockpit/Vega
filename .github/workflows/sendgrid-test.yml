name: sendgrid-test

on:
  push:
    branches: [ main ]

  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Send test email via SendGrid
        env:
          SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}
          TO: blainedares@gmail.com
          FROM: blainedares@gmail.com
        run: |
          if [ -z "${SENDGRID_API_KEY}" ]; then
            echo "âŒ Missing SENDGRID_API_KEY secret"
            exit 1
          fi

          cat > payload.json <<EOF
          {
            "personalizations":[{"to":[{"email":"${TO}"}]}],
            "from":{"email":"${FROM}"},
            "subject":"SendGrid test from GitHub Actions",
            "content":[{"type":"text/plain","value":"It works! If you see this, the key is valid."}]
          }
          EOF

          echo "Sending test email to ${TO}..."
          curl -i -X POST https://api.sendgrid.com/v3/mail/send \
            -H "Authorization: Bearer ${SENDGRID_API_KEY}" \
            -H "Content-Type: application/json" \
            --data-binary @payload.json
