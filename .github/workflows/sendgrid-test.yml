name: sendgrid-test
true:
  push:
    branches:
    - main
  workflow_dispatch: null
jobs:
  precheck:
    runs-on: ubuntu-latest
    outputs:
      ok: ${{ steps.p.outputs.ok }}
    steps:
    - uses: actions/checkout@v4
    - id: p
      uses: ./.github/actions/precheck
  test:
    runs-on: ubuntu-latest
    steps:
    - name: Send test email via SendGrid
      env:
        SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}
        TO: blainedares@gmail.com
        FROM: blainedares@gmail.com
      run: "if [ -z \"${SENDGRID_API_KEY}\" ]; then\n  echo \"\u274C Missing SENDGRID_API_KEY\
        \ secret\"\n  exit 1\nfi\n\ncat > payload.json <<EOF\n{\n  \"personalizations\"\
        :[{\"to\":[{\"email\":\"${TO}\"}]}],\n  \"from\":{\"email\":\"${FROM}\"},\n\
        \  \"subject\":\"SendGrid test from GitHub Actions\",\n  \"content\":[{\"\
        type\":\"text/plain\",\"value\":\"It works! If you see this, the key is valid.\"\
        }]\n}\nEOF\n\necho \"Sending test email to ${TO}...\"\ncurl -i -X POST https://api.sendgrid.com/v3/mail/send\
        \ \\\n  -H \"Authorization: Bearer ${SENDGRID_API_KEY}\" \\\n  -H \"Content-Type:\
        \ application/json\" \\\n  --data-binary @payload.json\n"
    needs: precheck
    if: ${{ needs.precheck.outputs.ok == 'true' && github.ref == 'refs/heads/main'
      }}
